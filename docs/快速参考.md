# PanHub å¿«é€Ÿå‚è€ƒ

## ğŸš€ å¸¸ç”¨å‘½ä»¤

### å¼€å‘
```bash
pnpm dev          # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm build        # æ„å»ºç”Ÿäº§ç‰ˆ
pnpm preview      # é¢„è§ˆç”Ÿäº§æ„å»º
```

### æµ‹è¯•
```bash
pnpm test                    # æ‰€æœ‰æµ‹è¯•
pnpm test:unit              # å•å…ƒæµ‹è¯• (112ä¸ª)
pnpm test:integration       # é›†æˆæµ‹è¯• (34ä¸ª)
pnpm test:coverage          # æµ‹è¯•è¦†ç›–ç‡
```

### å…¶ä»–
```bash
pnpm typecheck              # ç±»å‹æ£€æŸ¥
pnpm format                 # æ ¼å¼åŒ–ä»£ç 
pnpm lint                   # Lint æ£€æŸ¥
```

---

## ğŸ”§ API å¿«é€Ÿè°ƒç”¨

### æœç´¢ API
```bash
# GET è¯·æ±‚
curl "http://localhost:3000/api/search?kw=æµ‹è¯•&src=plugin&conc=5"

# POST è¯·æ±‚
curl -X POST http://localhost:3000/api/search \
  -H "Content-Type: application/json" \
  -d '{"kw":"æµ‹è¯•","src":"plugin","conc":5,"refresh":true}'
```

### çƒ­æœ API
```bash
curl "http://localhost:3000/api/hot-searches?limit=10"
```

### å¥åº·æ£€æŸ¥
```bash
curl "http://localhost:3000/api/health"
```

---

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶

### æœåŠ¡å±‚
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `server/core/services/searchService.ts` | æœç´¢æœåŠ¡ï¼ˆä¼˜å…ˆçº§æ‰¹å¤„ç†ï¼‰ |
| `server/core/plugins/manager.ts` | æ’ä»¶ç®¡ç†å™¨ |
| `server/core/services/hotSearchSQLite.ts` | çƒ­æœå­˜å‚¨ |
| `server/core/cache/memoryCache.ts` | LRU ç¼“å­˜ |

### API å±‚
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `server/api/search.get.ts` | æœç´¢ API (æ”¯æŒ GET/POST) |
| `server/api/hot-searches.get.ts` | çƒ­æœ API |
| `server/api/hot-search-stats.get.ts` | ç»Ÿè®¡ API |

### å‰ç«¯å±‚
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `composables/search/index.ts` | æœç´¢çŠ¶æ€ç®¡ç† |
| `composables/search/controller.ts` | æµç¨‹æ§åˆ¶ |
| `composables/search/merger.ts` | ç»“æœåˆå¹¶ |
| `pages/index/index.vue` | ä¸»é¡µé¢ |

### æ ¸å¿ƒå·¥å…·
| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `server/core/types/search.ts` | Zod éªŒè¯ Schema |
| `server/core/errors/app-error.ts` | ç»Ÿä¸€é”™è¯¯ç±» |
| `server/core/utils/error-handler.ts` | é”™è¯¯å¤„ç†å™¨ |
| `server/core/utils/fetch.ts` | å¢å¼º fetch (é‡è¯•+è¶…æ—¶) |
| `server/middleware/ratelimit.ts` | é€Ÿç‡é™åˆ¶ |

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡

### 1. ä¼˜å…ˆçº§æ‰¹å¤„ç†
```
é«˜ä¼˜å…ˆçº§æ’ä»¶ (concurrency=5) â†’ å¿«é€Ÿè¿”å› (~50ms)
æ™®é€šæ’ä»¶ (concurrency=3)     â†’ åå°æ‰§è¡Œ (~2-5s)
```

### 2. LRU ç¼“å­˜
```
å®¹é‡: 1000 æ¡
TTL: 30 åˆ†é’Ÿ
æ·˜æ±°: æœ€è¿‘æœ€å°‘ä½¿ç”¨
å‘½ä¸­ç‡: 40-80%
```

### 3. é”™è¯¯éš”ç¦»
```
å•ä¸ªæ’ä»¶å¤±è´¥ â†’ è¿”å›ç©ºæ•°ç»„
ä¸å½±å“å…¶ä»–æ’ä»¶
ç”¨æˆ·æ— æ„ŸçŸ¥
```

### 4. ä¾èµ–æ³¨å…¥
```typescript
const service = new SearchService(
  options,
  pluginManager  // æ³¨å…¥ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•
);
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### ç«¯å£å ç”¨
```bash
lsof -i :3000
kill -9 <PID>
```

### æ¸…ç†ç¼“å­˜
```bash
rm -rf node_modules .nuxt .output
pnpm install
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# å¼€å‘ç¯å¢ƒ
LOG_LEVEL=debug pnpm dev

# Docker
docker logs -f panhub
```

### æµ‹è¯•å¤±è´¥
```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•
npx vitest run test/integration/api.test.ts

# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
npx vitest run --reporter=verbose
```

---

## ğŸ“Š æµ‹è¯•çŠ¶æ€

```
âœ… å•å…ƒæµ‹è¯•: 112/112 é€šè¿‡ (9ä¸ªæ–‡ä»¶)
âœ… é›†æˆæµ‹è¯•: 34/34 é€šè¿‡ (3ä¸ªæ–‡ä»¶)
âœ… è¦†ç›–ç‡: >90% æ ¸å¿ƒé€»è¾‘
```

---

## ğŸ“ é…ç½®å‚è€ƒ

### ç¯å¢ƒå˜é‡ (.env)
```bash
LOG_LEVEL=info              # æ—¥å¿—çº§åˆ«
PORT=3000                   # æœåŠ¡ç«¯å£
RATE_LIMIT_MAX=60           # é€Ÿç‡é™åˆ¶
CACHE_TTL_MINUTES=30        # ç¼“å­˜æ—¶é—´
```

### æœç´¢é…ç½®
```typescript
// server/core/services/index.ts
const options = {
  priorityChannels: [],      // ä¼˜å…ˆé¢‘é“
  defaultChannels: [],       // é»˜è®¤é¢‘é“
  defaultConcurrency: 10,    // é»˜è®¤å¹¶å‘
  pluginTimeoutMs: 15000,    // æ’ä»¶è¶…æ—¶
  cacheEnabled: true,        // ç¼“å­˜å¼€å…³
  cacheTtlMinutes: 30,       // ç¼“å­˜æ—¶é—´
};
```

---

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
    â†“
[API] éªŒè¯å‚æ•° (Zod)
    â†“
[æœåŠ¡] SearchService.search()
    â”œâ”€â†’ æ£€æŸ¥ç¼“å­˜
    â”‚   â”œâ”€â†’ å‘½ä¸­ â†’ è¿”å›
    â”‚   â””â”€â†’ æœªå‘½ä¸­ â†’ ç»§ç»­
    â”œâ”€â†’ è·å–æ’ä»¶åˆ—è¡¨
    â”œâ”€â†’ ä¼˜å…ˆçº§åˆ†ç»„
    â”œâ”€â†’ å¹¶å‘æ‰§è¡Œ
    â”œâ”€â†’ ç»“æœåˆå¹¶
    â”œâ”€â†’ å†™å…¥ç¼“å­˜
    â””â”€â†’ è¿”å›å“åº”
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

| ç‰¹æ€§ | å®ç° | é˜²æŠ¤ |
|------|------|------|
| è¾“å…¥éªŒè¯ | Zod Schema | SQL æ³¨å…¥, XSS |
| é€Ÿç‡é™åˆ¶ | IP é™æµ | DDoS, æ»¥ç”¨ |
| è¶…æ—¶æ§åˆ¶ | Promise.race | æ— é™ç­‰å¾… |
| é”™è¯¯éš”ç¦» | try-catch | å•ç‚¹æ•…éšœ |

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å†·å¯åŠ¨ | 1-2s | é¦–æ¬¡åŠ è½½ |
| çƒ­æœç´¢ | 50ms | ç¼“å­˜å‘½ä¸­ |
| å®Œæ•´æœç´¢ | 2-5s | 5ä¸ªæ’ä»¶ |
| å¹¶å‘æ”¯æŒ | 10-20 | å¯é…ç½® |
| å†…å­˜å ç”¨ | 200-300MB | ç”Ÿäº§ç¯å¢ƒ |

---

## ğŸ“š æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | è¯´æ˜ | é¡µæ•° |
|------|------|------|
| `README.md` | é¡¹ç›®ä»‹ç» | 5 |
| `APIæ–‡æ¡£.md` | å®Œæ•´ API å‚è€ƒ | 15 |
| `éƒ¨ç½²æŒ‡å—.md` | éƒ¨ç½²æ–¹æ¡ˆ | 20 |
| `æ¶æ„è®¾è®¡.md` | æ¶æ„è¯¦è§£ | 15 |
| `å¿«é€Ÿå‚è€ƒ.md` | å¿«é€ŸæŸ¥è¯¢ | 3 |
| `æœªæ¥ä¼˜åŒ–ç‚¹.md` | ä¼˜åŒ–è®¡åˆ’ | 5 |
| `å•å…ƒæµ‹è¯•æŒ‡å—.md` | æµ‹è¯•è¯´æ˜ | 5 |
| `é›†æˆæµ‹è¯•æŒ‡å—.md` | é›†æˆæµ‹è¯• | 5 |

---

## ğŸ†˜ è·å–å¸®åŠ©

### é—®é¢˜åé¦ˆ
- **GitHub Issues**: https://github.com/wu529778790/panhub.shenzjd.com/issues
- **Email**: wu529778790@gmail.com

### å¸¸è§é—®é¢˜

**Q: æ’ä»¶æ²¡æœ‰è¢«åŠ è½½ï¼Ÿ**
A: æ£€æŸ¥ `server/core/services/index.ts` ä¸­çš„ `createPluginManager()`

**Q: POST è¯·æ±‚éªŒè¯å¤±è´¥ï¼Ÿ**
A: ç¡®ä¿ `refresh` å‚æ•°æ˜¯å¸ƒå°”å€¼æˆ–å­—ç¬¦ä¸² `'true'/'false'`

**Q: Docker æ•°æ®ä¸¢å¤±ï¼Ÿ**
A: ç¡®è®¤æŒ‚è½½äº†æ•°æ®å·ï¼š`-v /host/data:/app/data`

**Q: æµ‹è¯•è¶…æ—¶ï¼Ÿ**
A: æ£€æŸ¥ `vitest.config.ts` ä¸­çš„è¶…æ—¶é…ç½®

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (`pnpm test`)
- [ ] ç«¯å£æœªè¢«å ç”¨
- [ ] ç¯å¢ƒå˜é‡é…ç½®
- [ ] æ•°æ®ç›®å½•æƒé™ (Docker)
- [ ] é˜²ç«å¢™å¼€æ”¾ç«¯å£
- [ ] SSL è¯ä¹¦ (ç”Ÿäº§)
- [ ] æ—¥å¿—ç³»ç»Ÿé…ç½®
- [ ] ç›‘æ§å‘Šè­¦è®¾ç½®
- [ ] å¤‡ä»½ç­–ç•¥åˆ¶å®š

---

**ç‰ˆæœ¬**: v1.0 | **æ›´æ–°**: 2026-01-07 | **ç»´æŠ¤è€…**: PanHub Team
